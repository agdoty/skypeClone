
<body>
<div data-ng-controller="connectCtrl">
<style media="screen">
html{
  background-color: purple;
}
  body
    {
      max-width: 50%;
      margin: 2em auto;
      font-size: 20px;
    }

    h1
    {
      text-align: center;
    }

    .buttons-wrapper
    {
      text-align: center;
    }

    .hidden
    {
      display: none;
    }

    #video
    {
      display: block;
      width: 100%;
    }

    .button-demo
    {
      padding: 0.5em;
      display: inline-block;
      margin: 1em auto;
    }
</style>

        <!-- Create ROOM and get FRIENDS TO ADD -->
    <div class="newRoom">
        <h3>Enter Chat-Room Name</h3>
        <input ng-model="roomName.name" placeholder="Room Name"></input>
        <button class="button" id="newRoom-btn" ng-click="newRoom(roomName)">Create</button><br><br>

        <!-- GET FRIENDS TO ADD TO CHAT -->
        <button ng-click="getUsers()">get users</button>

        <div ng-repeat="friend in user.friends">{{friend.username}}
            <button ng-click="addToChat(friend._id, roomNew._id)">Add To Chat</button>
        </div>
        <ul id="roomName">{{roomNew.name}}</ul>
    </div>


<!-- V -->
<!-- I -->
<!-- D -->
<!-- <video id="video" autoplay="autoplay" controls="true"></video>
    <div class="buttons-wrapper">
      <button id="button-play-gum" class="button-demo" href="#">Play demo</button>
      <button id="button-stop-gum" class="button-demo" href="#">Stop demo</button>
    </div>
    <span id="gum-unsupported" class="hidden">API not supported</span>
    <span id="gum-partially-supported" class="hidden">API partially supported (video only)</span> -->
    <!-- <button type="button" name="button" ng-click="hasGetUserMedia()">test</button> -->
<!-- E -->
<!-- O -->
<!--  -->
        <!-- ENTIRE CHATBOX -->
    <div class='chatbox' ng-model="chatbox">
        <div>
            <div id="box-around-sent-msg" style="border-radius: 5px; color: black;">
                <div id="append-text" style="font-family: 'Raleway', sans-serif; color: black;" ng-repeat="message in messages">{{message.text}} : {{message.user.username}}</div>
            </div>
            <textarea ng-model='newMsg' class="user-thought" style="font-family: 'Raleway', sans-serif;" placeholder="Start Chatting.." style='height:7em; width:200%;'></textarea>
        <!-- <div id="char-count">500</div> -->
            <button class="button" id="thought-submit" ng-click="addMsg(newMsg, roomNew._id)">Send</button> <br><br>
        </div>
        <!-- GET PAST CHATS -->
    </div>
    <br><br>
    <button class="button" id="pastchat" ng-click="chatUserIn()" style="font-family: 'Raleway', sans-serif;">Get Past Chats</button><br>
    <div id="getchats" style="font-family: 'Raleway', sans-serif;" ng-repeat="chat in allowedChats">{{chat.name}}
        <button class="connectBtn" style="font-family: 'Raleway', sans-serif;" ng-click="getChatRooms(chat._id)">+</button>
    </div>
    {{chatObj}}

</div>
<!-- N -->
<!-- E -->
<!-- W -->
<div>
 <video id="myvideo"  style="transform: rotateY(-180deg);" autoplay muted controls="true" ></video>
</div>
<!-- V -->
<!-- I -->
<!-- D -->
<script type="text/javascript">
var skylink = new Skylink();

skylink.on('peerJoined', function(peerId, peerInfo, isSelf) {
  if(isSelf) return; // We already have a video element for our video and don't need to create a new one.
  var vid = document.createElement('video');
  vid.autoplay = true;
  vid.muted = true; // Added to avoid feedback when testing locally
  vid.id = peerId;
  document.body.appendChild(vid);
});

skylink.on('incomingStream', function(peerId, stream, isSelf) {
  if(isSelf) return;
  var vid = document.getElementById(peerId);
  attachMediaStream(vid, stream);
});
skylink.on('peerLeft', function(peerId, peerInfo, isSelf) {
  var vid = document.getElementById(peerId);
  document.body.removeChild(vid);
});

skylink.on('mediaAccessSuccess', function(stream) {
  var vid = document.getElementById('myvideo');
  attachMediaStream(vid, stream);
});

skylink.init({
  apiKey: '13c2f3f9-73c3-42a4-b13c-3da36e3bd1f2',
  defaultRoom: 'Chat'
}, function() {
  skylink.joinRoom({
    audio: true,
    video: true
  });
});
</script>
</body>
